

## 一、稳定性定义
- 百度百科定义：当一个实际的系统处于一个平衡的状态时如果受到外来作用的影响时，系统经过一个过渡过程仍然能够回到原来的平衡状态
互联网行业系统稳定性即系统可用性，衡量标准即系统全年可用时间（时间维度），常见的3个9，4个9等等

## 二、稳定性影响因子
总结来说，一个系统的稳定性由2个因子决定，即稳定性可表达为如下公式
```JSON
y(系统稳定性) = f(MTBF,MTTR)
```
其中MTBF和MTTR定义如下：
- MTBF(mean time between failure):系统多久会发生一次故障
- MTTR(mean time to repair): 系统发生故障后，一般多久能恢复

MTBF衡量了一个系统发生故障的频率，而MTTR则衡量了系统故障发生后的恢复水平

## 三、如何提高系统稳定性
 接下来我们将一下如何系统系统稳定性。系统的稳定性，从思路上是从事前预防、事中应急和事后总结三方面来提高，针对这3个方面再衍生出对应的抓手
### 事前预防
故障发生后一般都会造成不可挽回的损失，轻者流量损失，重者会造成资损，更甚者会造成用户对平台失去信任，影响整个平台的品牌。因此，如何在故障发生前，能有效的预防故障发生，是提高稳定性中投入产出比最高的。接下来，我从以下几个抓手来讲述如何做事前预防
- 研发质量、测试质量
  从产品研发周期中，一个产品的研发和测试是产品投入使用前必不可少的2个流程。研发质量的好坏如系统架构、编码水平、是否合理使用线程池等等都是影响系统稳定性的关键因素。而测试是产品上线前的最后一道关卡，如果测试质量不过关，不合格的产品投入线上，对线上系统稳定性同样会造成很大的影响
- 变更管理
  google数据统计，线上70%的故障是由于线上变更造成的。常规上来说，一个系统一年都没有任何变更的话，一般不会发生故障。因此，如何做好变更管理也是预防故障的一种有效方案。一般来说主要通过以下2个方面来进行管理
  -  流程建设：制定标准化流程建设
  -  变更通知：任何变更都要有通知提醒，做到各方周知
- 容量规划
  一个线上运行的系统，系统可承受的容量是维护该系统人员心中的一根弦。一般来说，我们通过以下几个方面来做
  - 单模块压测及全链路压测：一般通过单模块来粗估系统的容量，当有条件时再通过全链路压测发现整个链路中的短板
  - 容量评估及扩容：通过上一步的压测确定系统的容量，短期内可以通过加机器水平扩容来扩大容量
  - 性能优化：时间充裕的情况下对压测中发现的瓶颈问题进行专项的性能优化
- 值班巡检：建立值班巡检制度，定时监控系统运行状况
- 故障演练：提前进行故障演练，可测试整个系统对故障的应急处理预案等是否健全
### 事中应急
事中应急主要从如何快速发现及定位故障，以及如何快速止损这2个方面来应对
- 故障发现及定位
  - 监控：建立健全的监控体系，线上故障主动预警，减少故障发现时间，主要包括以下监控项
    - 基础监控：包括机器监控和模块监控。机器监控包括cpu 、 内存、磁盘等，模块监控包括 端口、 进程等监控
    - 网络监控&CDN监控
    - DB监控
    - 业务监控
    - 异常监控
    - 日志监控
  - 链路跟踪：实现整条调用链跟踪，可以准确定位故障发生点
- 故障止损
  - 降级: 降级主要应对系统自身的故障，将某些业务或者接口的功能降低，可以是只提供部分功能，也可以完全停掉所有功能。核心思想是丢车保帅，优先保证核心业务
  - 熔断：熔断目的是应对依赖的外部系统故障的情况
  - 限流：限流是从用户访问压力的角度来应对故障。当系统当前流量超过系统的承受能力时，主动拒绝部分用户请求
  - 排队：排队是一种特殊的策略，当当前用户流量超出系统处理能力时，又不想拒绝用户请求时的一种策略。典型的就是12306系统
  - 容灾：容灾更多的是从冗余角度去保护系统可以处理一些预料之外的灾难。如某个城市断电、光纤被挖断等等，典型的是2地3中心策略
### 事后总结
事后总结主要是故障发生后，对故障的处理以及故障预防方面看是否还有改进空间，并对此进行优化
- 复盘：事后复盘，对故障发生的原因、可改进项、流程优化等方面做一个总结复盘，避免再次踩坑
- 评测：复盘后，对系统稳定性再次进行评测，评估是否还有潜在问题，并优化
